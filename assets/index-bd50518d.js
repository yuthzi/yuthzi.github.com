import{bn as k,bh as B}from"./index-b2e15df3.js";import{h as x,J as A,r as f,a3 as s,j as m,v as b,x as r,D as t,B as g,k as P,ah as z,ai as E,l as F,ag as G,ad as I,y as V,u as R,F as C}from"./_plugin-vue_export-helper-33be20d1.js";import{u as j}from"./useHandleData-fc19fefe.js";import"./IconifyIcon-a624bcfa.js";function J(n){return k.get(`/admin/cms/banner/${n.pageNum}/${n.pageSize}`)}function H(n){return k.post("/admin/cms/banner/save",n)}function K(n){return k.put("/admin/cms/banner/modify",n)}function O(n){return k.delete(`/admin/cms/banner/remove/${n}`)}const M=n=>(z("data-v-fa20bdfa"),n=n(),E(),n),Q=["src"],W=M(()=>F("div",{class:"el-upload__tip"},"只能上传jpg/png文件，且不超过50kb",-1)),X=x({name:"UserDrawer"}),Y=x({...X,setup(n,{expose:y}){const v=A({title:[{required:!0,message:"请填写banner名称"}],imageUrl:[{required:!0,message:"请上传Banner图片"}],linkUrl:[{required:!0,message:"请填写跳转地址"}],sort:[{required:!0,message:"请填写排序"}]}),p=f(!1),l=f({title:""}),c=f(!1),D=o=>{l.value=o,p.value=!0},a=(o,e)=>{console.log(o,e),l.value.rowData.imageUrl=o.data},_=o=>{const e=["image/jpeg","image/png"].indexOf(o.type)>=0,d=o.size/1024>50;return e||B.error("上传头像图片只能是 JPG/PNG 格式!"),d||B.error("上传头像图片大小不能超过 50K!"),e&&d},u=f(),U=()=>{u.value.validate(async o=>{if(o)try{c.value=!0,await l.value.api(l.value.rowData),B.success({message:`${l.value.title}品牌成功！`}),l.value.getTableList(),p.value=!1,c.value=!1}catch(e){c.value=!1,console.log(e)}})};return y({acceptParams:D}),(o,e)=>{const d=s("el-input"),w=s("el-form-item"),$=s("Plus"),T=s("el-icon"),q=s("el-upload"),L=s("el-input-number"),N=s("el-form"),h=s("el-button"),S=s("el-drawer");return m(),b(S,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=i=>p.value=i),"destroy-on-close":!0,size:"450px",title:`${l.value.title}用户`},{footer:r(()=>[t(h,{onClick:e[3]||(e[3]=i=>p.value=!1)},{default:r(()=>[g("取消")]),_:1}),t(h,{type:"primary",onClick:U,loading:c.value},{default:r(()=>[g(" 确定 ")]),_:1},8,["loading"])]),default:r(()=>[t(N,{ref_key:"ruleFormRef",ref:u,"label-width":"100px","label-suffix":" :",rules:v,model:l.value.rowData},{default:r(()=>[t(w,{label:"标题",prop:"title"},{default:r(()=>[t(d,{modelValue:l.value.rowData.title,"onUpdate:modelValue":e[0]||(e[0]=i=>l.value.rowData.title=i),placeholder:"请填写品牌名称",clearable:""},null,8,["modelValue"])]),_:1}),t(w,{label:"Banner",prop:"imageUrl"},{default:r(()=>[t(q,{class:"avatar-uploader",action:"dev-api/admin/product/fileUpload","show-file-list":!1,"on-success":a,"before-upload":_},{tip:r(()=>[W]),default:r(()=>[l.value.rowData.imageUrl?(m(),P("img",{key:0,src:l.value.rowData.imageUrl,class:"avatar"},null,8,Q)):(m(),b(T,{key:1,class:"avatar-uploader-icon"},{default:r(()=>[t($)]),_:1}))]),_:1})]),_:1}),t(w,{label:"链接",prop:"linkUrl"},{default:r(()=>[t(d,{modelValue:l.value.rowData.linkUrl,"onUpdate:modelValue":e[1]||(e[1]=i=>l.value.rowData.linkUrl=i),placeholder:"请填写跳转链接",clearable:""},null,8,["modelValue"])]),_:1}),t(w,{label:"排序",prop:"sort"},{default:r(()=>[t(L,{modelValue:l.value.rowData.sort,"onUpdate:modelValue":e[2]||(e[2]=i=>l.value.rowData.sort=i),min:1},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}});const Z=G(Y,[["__scopeId","data-v-fa20bdfa"]]),re=x({__name:"index",setup(n){const y=[{type:"index",label:"#",width:80},{prop:"imageUrl",label:"图片链接",render:({row:a})=>t(C,null,[t(s("el-image"),{src:a.imageUrl,lazy:!0},null)])},{prop:"linkUrl",label:"跳转链接",render:({row:a})=>t(C,null,[t(s("el-link"),{href:a.linkUrl,target:"_blank",type:"primary"},{default:()=>[a.linkUrl]})])},{prop:"title",label:"标题"},{prop:"sort",label:"排序"},{prop:"operation",label:"操作",fixed:"right",width:150}],v=f(),p=a=>({list:a==null?void 0:a.records,total:a==null?void 0:a.total}),l=f(),c=async(a,_={})=>{let u={title:a,rowData:{..._},api:a==="编辑"?K:H,getTableList:v.value.getTableList};l.value.acceptParams(u)},D=async a=>{await j(O,a.id,`删除${a.title}`),v.value.getTableList()};return(a,_)=>{const u=s("el-button"),U=s("ProTable"),o=I("auth");return m(),P("div",null,[t(U,{ref_key:"proTable",ref:v,dataCallback:p,columns:y,requestApi:R(J)},{tableHeader:r(()=>[V((m(),b(u,{type:"primary",icon:"Plus",onClick:_[0]||(_[0]=e=>c("新增"))},{default:r(()=>[g(" 添加 ")]),_:1})),[[o,["Banner.Btn.Add"]]])]),operation:r(e=>[V((m(),b(u,{type:"primary",link:"",icon:"Edit",onClick:d=>c("编辑",e.row)},{default:r(()=>[g(" 修改 ")]),_:2},1032,["onClick"])),[[o,["Banner.Btn.Edit"]]]),V((m(),b(u,{type:"danger",link:"",icon:"Delete",onClick:d=>D(e.row)},{default:r(()=>[g(" 删除 ")]),_:2},1032,["onClick"])),[[o,["Banner.Btn.Delete"]]])]),_:1},8,["requestApi"]),t(Z,{ref_key:"drawerRef",ref:l},null,512)])}}});export{re as default};
