import{bn as C,V as I,bh as h}from"./index-b2e15df3.js";import{u as P}from"./useHandleData-fc19fefe.js";import{h as T,J as w,a3 as i,ad as X,j as f,k as b,D as a,x as l,y as L,l as S,B as d,v as N,F as q,X as z,u as m,C as x}from"./_plugin-vue_export-helper-33be20d1.js";import"./IconifyIcon-a624bcfa.js";function G(p,e,n){return C.get(`/admin/product/attrInfoList/${p}/${e}/${n}`)}function K(p){return C.delete(`/admin/product/deleteAttr/${p}`)}function Q(p){return C.post("/admin/product/saveAttrInfo",p)}const W=["onClick"],ae=T({__name:"index",setup(p){const e=w({loading:!1,category1Id:null,category2Id:null,category3Id:null,attrs:[],isShowList:!0});let n=w({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3});const $=({categoryId:t,level:r})=>{r===1?(e.category2Id=null,e.category3Id=null,e.attrs=[],e.category1Id=t):r===2?(e.category3Id=null,e.attrs=[],e.category2Id=t):(e.category3Id=t,v())},v=async()=>{const{category1Id:t,category2Id:r,category3Id:_}=e;e.loading=!0;const g=await G(t,r,_);e.loading=!1,e.attrs=g.data},A=()=>{n={attrName:"",attrValueList:[],categoryId:e.category3Id,categoryLevel:3},e.isShowList=!1},D=t=>{n=JSON.parse(JSON.stringify(t)),e.isShowList=!1},B=async t=>{await P(K,t.id,`删除${t.attrName}角色`),v()},O=()=>{const t={attrId:n.id,valueName:"",edit:!0};n.attrValueList.push(t)},U=t=>{if(t.valueName.trim()==="")return;if(n.attrValueList.filter(_=>_.valueName===t.valueName).length===2){h.warning("属性名称不能重复"),t.valueName="";return}t.edit=!1},E=(t,r)=>{console.log(t,r)},J=async()=>{if(n.attrValueList=n.attrValueList.filter(t=>t.valueName?(delete t.edit,!0):!1),n.attrValueList.length===0){h.warning("至少指定一个属性值名称");return}try{await Q(n),h.success("保存属性成功"),e.isShowList=!0,v()}catch(t){console.log(t)}};return(t,r)=>{const _=i("CategorySelector"),g=i("el-card"),c=i("el-button"),u=i("el-table-column"),F=i("el-tag"),V=i("el-table"),k=i("el-input"),R=i("el-form-item"),j=i("el-form"),H=i("el-popconfirm"),M=X("loading");return f(),b("div",null,[a(g,null,{default:l(()=>[a(_,{onCategoryChange:$,ref:"cs"},null,512)]),_:1}),a(g,{style:{margin:"20px 0"}},{default:l(()=>[L(S("div",null,[a(c,{type:"primary",icon:"Plus",style:{"margin-bottom":"20px"},onClick:A,disabled:!e.category3Id},{default:l(()=>[d(" 添加 ")]),_:1},8,["disabled"]),L((f(),N(V,{data:e.attrs,border:""},{default:l(()=>[a(u,{label:"序号",type:"index",width:"80",align:"center"}),a(u,{label:"属性名称",prop:"attrName",width:"150"}),a(u,{label:"属性值列表"},{default:l(({row:o})=>[(f(!0),b(q,null,z(o.attrValueList,s=>(f(),N(F,{type:"info",key:s.id,style:{"margin-right":"5px"}},{default:l(()=>[d(x(s.valueName),1)]),_:2},1024))),128))]),_:1}),a(u,{label:"操作",width:"200"},{default:l(({row:o})=>[a(c,{type:"primary",icon:"Edit",onClick:s=>D(o)},{default:l(()=>[d(" 修改 ")]),_:2},1032,["onClick"]),a(c,{type:"danger",icon:"Delete",onClick:s=>B(o)},{default:l(()=>[d(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[M,e.loading]])],512),[[I,e.isShowList]]),L(S("div",null,[a(j,{inline:""},{default:l(()=>[a(R,{label:"属性名"},{default:l(()=>[a(k,{type:"text",placeholder:"请输入属性名",modelValue:m(n).attrName,"onUpdate:modelValue":r[0]||(r[0]=o=>m(n).attrName=o)},null,8,["modelValue"])]),_:1})]),_:1}),a(c,{type:"primary",icon:"el-icon-plus",onClick:O,disabled:!m(n).attrName},{default:l(()=>[d(" 添加属性值 ")]),_:1},8,["disabled"]),a(c,{onClick:r[1]||(r[1]=o=>e.isShowList=!0)},{default:l(()=>[d("取消")]),_:1}),a(V,{border:"",style:{margin:"20px 0"},data:m(n).attrValueList},{default:l(()=>[a(u,{label:"序号",type:"index",width:"80",align:"center"}),a(u,{label:"属性值名称"},{default:l(({row:o,$index:s})=>[o.edit?(f(),N(k,{key:0,ref:s,modelValue:o.valueName,"onUpdate:modelValue":y=>o.valueName=y,placeholder:"请输入名称",onBlur:y=>U(o)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(f(),b("span",{key:1,onClick:y=>E(o,s),style:{display:"inline-block",width:"100%"}},x(o.valueName),9,W))]),_:1}),a(u,{label:"操作"},{default:l(({row:o,$index:s})=>[a(H,{title:`确定删除 ${o.valueName} 吗?`,onOnConfirm:y=>m(n).attrValueList.splice(s,1)},{default:l(()=>[a(c,{style:{"margin-left":"10px"},type:"danger",icon:"Delete"},{default:l(()=>[d(" 删除 ")]),_:1})]),_:2},1032,["title","onOnConfirm"])]),_:1})]),_:1},8,["data"]),a(c,{type:"primary",disabled:!m(n).attrName||m(n).attrValueList.length===0,onClick:J},{default:l(()=>[d(" 保存 ")]),_:1},8,["disabled"]),a(c,{onClick:r[2]||(r[2]=o=>e.isShowList=!0)},{default:l(()=>[d("取消")]),_:1})],512),[[I,!e.isShowList]])]),_:1})])}}});export{ae as default};
