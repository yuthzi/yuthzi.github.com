import{u as w}from"./useHandleData-fc19fefe.js";import{bh as U,bk as q}from"./index-b2e15df3.js";import{b as L,c as R,u as $,d as S}from"./permission-d741be8f.js";import{h,r as f,J as A,a3 as b,j as _,v as x,x as s,D as r,B as C,u as i,a as F,k as O,A as V,C as z,ag as M}from"./plugin-vue_export-helper-33be20d1.js";import"./IconifyIcon-a624bcfa.js";const j=h({name:"RoleDialog"}),E=h({...j,setup(I,{expose:v}){let a=f({menuName:"",code:"",pattern:"",seq:1});const c=A({menuName:[{required:!0,message:"请填写名称"}],code:[{required:!0,message:"请填写权限值"}],pattern:[{required:!0,message:"请填写URL值"}]}),m=f(!1),g=f(),y=f(!1),k=f({type:1}),T=l=>{const e=l.rowData;l.type===1?a.value={pid:e.menuId,level:e.level+1,type:e.level==3?2:1}:a.value=e,g.value=t(l),k.value=l,m.value=!0},t=l=>{const e=l.rowData&&l.rowData.level;let n="";return l.type===1?(e===1&&(n="添加一级菜单"),e===2&&(n="添加二级菜单"),e===3&&(n="添加功能")):(e===1&&(n="修改一级菜单"),(e===2||e===3)&&(n="修改二级菜单"),e===3&&(n="修改功能")),n},u=f(),o=l=>{l&&l.validate(async e=>{if(e)try{y.value=!0,await k.value.api(a.value),U.success({message:`${g.value}成功！`}),k.value.getTableList(),m.value=!1,y.value=!1,p(l)}catch(n){y.value=!1,console.log(n)}})},p=l=>{l&&l.resetFields()};return v({acceptParams:T}),(l,e)=>{const n=b("el-input"),D=b("el-form-item"),N=b("el-form"),B=b("el-button"),P=b("el-dialog");return _(),x(P,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=d=>m.value=d),title:g.value,"destroy-on-close":!0,width:"500px"},{footer:s(()=>[r(B,{onClick:e[4]||(e[4]=d=>m.value=!1)},{default:s(()=>[C("取消")]),_:1}),r(B,{type:"primary",onClick:e[5]||(e[5]=d=>o(u.value)),loading:y.value},{default:s(()=>[C(" 确定 ")]),_:1},8,["loading"])]),default:s(()=>[r(N,{ref_key:"ruleFormRef",ref:u,"label-width":"100px","label-suffix":" :",rules:c,model:i(a)},{default:s(()=>[r(D,{label:"名称",prop:"menuName"},{default:s(()=>[r(n,{modelValue:i(a).menuName,"onUpdate:modelValue":e[0]||(e[0]=d=>i(a).menuName=d),placeholder:"请填写名称",clearable:""},null,8,["modelValue"])]),_:1}),r(D,{label:"权限值",prop:"code"},{default:s(()=>[r(n,{modelValue:i(a).code,"onUpdate:modelValue":e[1]||(e[1]=d=>i(a).code=d),placeholder:"请填写权限值",clearable:""},null,8,["modelValue"])]),_:1}),r(D,{label:"URL",prop:"pattern"},{default:s(()=>[r(n,{modelValue:i(a).pattern,"onUpdate:modelValue":e[2]||(e[2]=d=>i(a).pattern=d),placeholder:"请填写URL",clearable:""},null,8,["modelValue"])]),_:1}),r(D,{label:"排序值",prop:"seq"},{default:s(()=>[r(n,{modelValue:i(a).seq,"onUpdate:modelValue":e[3]||(e[3]=d=>i(a).seq=d),placeholder:"请填写排序值",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),H=()=>{const v=q().authButtonList||[];return{BUTTONS:F(()=>{const c={};return v.forEach(m=>c[m]=!0),c})}},J=h({__name:"index",setup(I){const{BUTTONS:v}=H(),a=[{prop:"menuName",label:"名称",align:"left"},{prop:"code",label:"权限值"},{prop:"seq",label:"排序值"},{prop:"pattern",label:"URL"},{prop:"gmtModified",label:"修改时间"},{prop:"operation",label:"操作",fixed:"right",width:300}],c=f(),m=f(),g=(t,u)=>{const o={type:t,rowData:{...u},api:t==1?R:$,getTableList:c.value.getTableList};m.value.acceptParams(o)},y=async(t={})=>{await w(S,t==null?void 0:t.menuId,`删除${t.menuName}`),c.value.getTableList()};function k(t,u){let o=c.value.tableData;if(t.level==1){const p=o.findIndex(l=>l.menuId===t.menuId);T(o,t,p,u)}else if(t.level==2){const p=o.findIndex(e=>e.menuId===t.pid),l=o[p].children.findIndex(e=>e.menuId===t.menuId);T(o[p].children,t,l,u)}}function T(t,u,o,p){p?(t.splice(o,1),t.splice(o-1,0,u)):(t.splice(o,1),t.splice(o+1,0,u));for(let l=0;l<t.length;l++)t[l].seq=l+1}return(t,u)=>{const o=b("el-button"),p=b("ProTable");return _(),O("div",null,[r(p,{ref_key:"proTable",ref:c,selectId:"menuId",pagination:!1,toolButton:!1,columns:a,requestApi:i(L)},{operation:s(l=>[l.row.level<3?(_(),x(o,{key:0,text:"",size:"large",class:"arrow",type:"primary",title:"下移",onClick:e=>k(l.row,!1),icon:"Bottom"},null,8,["onClick"])):V("",!0),l.row.level<3?(_(),x(o,{key:1,text:"",size:"large",class:"arrow",type:"primary",title:"上移",onClick:e=>k(l.row,!0),icon:"Top"},null,8,["onClick"])):V("",!0),i(v)["btn.Permission.add"]?(_(),x(o,{key:2,type:"primary",link:"",icon:"UserFilled",disabled:l.row.level===3,onClick:e=>g(1,l.row)},{default:s(()=>[C(z(l.row.level>=2?"添加功能":"添加菜单"),1)]),_:2},1032,["disabled","onClick"])):V("",!0),i(v)["btn.Permission.update"]?(_(),x(o,{key:3,type:"primary",link:"",icon:"Edit",onClick:e=>g(2,l.row)},{default:s(()=>[C(" 编辑 ")]),_:2},1032,["onClick"])):V("",!0),i(v)["btn.Permission.remove"]?(_(),x(o,{key:4,type:"primary",link:"",icon:"Delete",onClick:e=>y(l.row)},{default:s(()=>[C(" 删除 ")]),_:2},1032,["onClick"])):V("",!0)]),_:1},8,["requestApi"]),r(E,{ref_key:"DialogRef",ref:m},null,512)])}}});const Y=M(J,[["__scopeId","data-v-5ae4bd2c"]]);export{Y as default};
