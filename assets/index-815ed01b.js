import{bn as _,bK as F,bh as A}from"./index-b2e15df3.js";import{h as T,J as $,r as C,a3 as m,j as u,v as p,x as n,D as i,B as b,A as L,k as S,X as N,F as q,C as H,ad as M,y as R,u as j}from"./plugin-vue_export-helper-33be20d1.js";import{u as x}from"./useHandleData-fc19fefe.js";import"./IconifyIcon-a624bcfa.js";function z(s){return _.post("/admin/acl/user/list",s).then(d=>{var k;if(d.code==F.SUCCESS){const c=(k=d.data)==null?void 0:k.records;for(let a=0;a<c.length;a++){const f=c[a];f.enable=f.enable==1}}return d})}function J(s){return _.post("/admin/acl/user/add",s)}function E(s){return s.enable=s.enable?1:0,_.put("/admin/acl/user/modify",s)}function K(s){return _.delete(`/admin/acl/user/remove/${s}`)}function X(s){return _.delete("/admin/acl/user/batchRemove",s)}function G(s){return _.get(`/admin/acl/user/roleList/${s}`)}function O(s){return _.post("/admin/acl/user/doAssignRole",s)}const Q=T({name:"UserDrawer"}),W=T({...Q,setup(s,{expose:d}){const k=$({username:[{required:!0,message:"请填写用户姓名"},{min:4,message:"用户名不能小于4位"}],password:[{required:!0,message:"请填写用户密码"},{min:6,message:"密码不能小于6位"}]}),c=C(!1),a=C({title:""}),f=C(!1),t=$({allRolesList:[],assignRoles:[],checkAll:!1,isIndeterminate:!1}),w=l=>{t.assignRoles=l?t.allRolesList.map(e=>e.roleId):[],console.log(t.assignRoles),t.isIndeterminate=!1},I=l=>{const e=l.length;t.checkAll=e===t.allRolesList.length,t.isIndeterminate=e>0&&e<t.allRolesList.length},U=l=>{if(l.title==="分配角色"){const{list:e}=l;t.allRolesList=e.data.allRolesList,t.assignRoles=e.data.assignRoles.map(r=>r.roleId),t.isIndeterminate=t.assignRoles.length>0}a.value=l,c.value=!0},V=C(),D=()=>{V.value.validate(async l=>{if(l)try{if(f.value=!0,a.value.title==="分配角色"){const e={userId:a.value.rowData.userId,roleIdList:t.assignRoles};await a.value.api(e)}else await a.value.api(a.value.rowData);A.success({message:`${a.value.title}用户成功！`}),a.value.getTableList(),c.value=!1,f.value=!1}catch(e){f.value=!1,console.log(e)}})};return d({acceptParams:U}),(l,e)=>{const r=m("el-input"),h=m("el-form-item"),g=m("el-checkbox"),v=m("el-checkbox-group"),y=m("el-form"),P=m("el-button"),B=m("el-drawer");return u(),p(B,{modelValue:c.value,"onUpdate:modelValue":e[6]||(e[6]=o=>c.value=o),"destroy-on-close":!0,size:"450px",title:`${a.value.title}用户`},{footer:n(()=>[i(P,{onClick:e[5]||(e[5]=o=>c.value=!1)},{default:n(()=>[b("取消")]),_:1}),i(P,{type:"primary",onClick:D,loading:f.value},{default:n(()=>[b(" 确定 ")]),_:1},8,["loading"])]),default:n(()=>[i(y,{ref_key:"ruleFormRef",ref:V,"label-width":"100px","label-suffix":" :",rules:k,model:a.value.rowData},{default:n(()=>[i(h,{label:"用户姓名",prop:"username"},{default:n(()=>[i(r,{disabled:a.value.title==="分配角色",modelValue:a.value.rowData.username,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.rowData.username=o),placeholder:"请填写用户姓名",clearable:""},null,8,["disabled","modelValue"])]),_:1}),a.value.title!=="分配角色"?(u(),p(h,{key:0,label:"用户昵称",prop:"nickname"},{default:n(()=>[i(r,{modelValue:a.value.rowData.nickname,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.rowData.nickname=o),placeholder:"请填写用户昵称",clearable:""},null,8,["modelValue"])]),_:1})):L("",!0),a.value.title==="新增"?(u(),p(h,{key:1,label:"用户密码",prop:"password"},{default:n(()=>[i(r,{modelValue:a.value.rowData.password,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.rowData.password=o),placeholder:"请填写用户密码",clearable:""},null,8,["modelValue"])]),_:1})):L("",!0),a.value.title==="分配角色"?(u(),p(h,{key:2,label:"角色列表",prop:"rolesId"},{default:n(()=>[i(g,{modelValue:t.checkAll,"onUpdate:modelValue":e[3]||(e[3]=o=>t.checkAll=o),indeterminate:t.isIndeterminate,onChange:w},{default:n(()=>[b(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),i(v,{modelValue:t.assignRoles,"onUpdate:modelValue":e[4]||(e[4]=o=>t.assignRoles=o),onChange:I},{default:n(()=>[(u(!0),S(q,null,N(t.allRolesList,o=>(u(),p(g,{key:o.roleId,label:o.roleId},{default:n(()=>[b(H(o.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):L("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),ae=T({__name:"index",setup(s){const d=C(),k=[{type:"selection",fixed:"left",width:80},{type:"index",label:"#",width:80},{prop:"userId",label:"id"},{prop:"username",label:"用户名",search:{el:"input",props:{placeholder:"输入用户名"}}},{prop:"nickname",label:"用户昵称",search:{el:"input",props:{placeholder:"输入用户昵称"}}},{prop:"roleName",label:"角色列表"},{prop:"enable",label:"是否启用",render:({row:l})=>i(m("el-switch"),{modelValue:l.enable,"onUpdate:modelValue":e=>l.enable=e,beforeChange:e=>V(e,l),onChange:e=>{D(e,l)},style:"--el-switch-on-color: #13ce66;"},null)},{prop:"gmtCreate",label:"创建时间",sortable:!0},{prop:"gmtModified",label:"更新时间",sortable:!0},{prop:"operation",label:"操作",fixed:"right",width:280}],c=5,a=$({}),f=l=>({list:l==null?void 0:l.records,total:l==null?void 0:l.total}),t=C(),w=async(l,e={})=>{let r={title:l,rowData:{...e},list:l==="分配角色"?await G(e.userId||""):[],api:l==="新增"?J:l==="编辑"?E:O,getTableList:d.value.getTableList};t.value.acceptParams(r)},I=async l=>{if((l==null?void 0:l.username)==="admin"){A({type:"warning",message:"系统用户不允许删除"});return}await x(K,l.userId,`删除${l.username}用户`),d.value.getTableList()},U=async l=>{await x(X,l,"删除所选用户信息"),d.value.clearSelection(),d.value.getTableList()},V=(l,e)=>(e==null?void 0:e.username)==="admin"?(A({type:"warning",message:"系统用户不允许修改"}),!1):!0,D=async(l,e)=>{const r={userId:e.userId,enable:l?1:0};await x(E,r,l?`启用${e.nickname}用户`:`禁用${e.nickname}用户`)};return(l,e)=>{const r=m("el-button"),h=m("ProTable"),g=M("auth");return u(),S("div",null,[i(h,{ref_key:"proTable",ref:d,selectId:"userId",dataCallback:f,columns:k,searchCol:c,requestApi:j(z),initParam:a},{tableHeader:n(v=>[R((u(),p(r,{type:"primary",icon:"Plus",onClick:e[0]||(e[0]=y=>w("新增"))},{default:n(()=>[b(" 添加 ")]),_:1})),[[g,["btn.User.add"]]]),R((u(),p(r,{type:"danger",icon:"Delete",plain:"",onClick:y=>U(v.selectedListIds),disabled:!v.isSelected},{default:n(()=>[b(" 批量删除 ")]),_:2},1032,["onClick","disabled"])),[[g,["btn.User.remove"]]])]),operation:n(v=>[R((u(),p(r,{type:"primary",link:"",icon:"UserFilled",onClick:y=>w("分配角色",v.row)},{default:n(()=>[b(" 分配角色 ")]),_:2},1032,["onClick"])),[[g,["btn.User.assgin"]]]),R((u(),p(r,{type:"primary",link:"",icon:"Edit",onClick:y=>w("编辑",v.row)},{default:n(()=>[b(" 编辑 ")]),_:2},1032,["onClick"])),[[g,["btn.User.update"]]]),R((u(),p(r,{type:"primary",link:"",icon:"Delete",onClick:y=>I(v.row)},{default:n(()=>[b(" 删除 ")]),_:2},1032,["onClick"])),[[g,"btn.User.remove"]])]),_:1},8,["requestApi","initParam"]),i(W,{ref_key:"drawerRef",ref:t},null,512)])}}});export{ae as default};
